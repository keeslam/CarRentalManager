# CarRentalManager - Fixed syntax voor Coolify (geen multi-line bash)

[variables]
NIXPACKS_NODE_VERSION = "18"
NODE_ENV = "production"
PORT = "3000"

# Installatie: Root + client/ + server/ dependencies (single-line)
[phases.install]
cmds = [
  "npm ci --omit=dev",
  "cd client && npm ci --omit=dev || echo 'Client install skipped'",
  "cd server && npm ci --omit=dev || echo 'Server install skipped'",
  "echo 'Dependencies installed'"
]

# Build: Frontend + Backend (single-line commands, geen if-fi)
[phases.build]
cmds = [
  "echo '=== BUILD START ==='",
  "ls -la",  # Toon structuur
  "cd client && npm run build || echo 'Frontend build failed - check client/package.json'",
  "cd server && npm run build || echo 'Backend build failed - check server/tsconfig.json'",
  "mkdir -p server/dist/public || echo 'Public dir creation failed'",
  "cp -r client/dist/* server/dist/public/ 2>/dev/null || cp -r client/build/* server/dist/public/ 2>/dev/null || echo 'Frontend copy failed'",
  "ls -la server/dist/public/ || echo 'No static files copied'",
  "if [ -f server/dist/public/index.html ]; then echo '✅ Frontend ready'; else echo '❌ Noindex.html - build issue'; fi",
  "echo '=== BUILD END ==='"
]

# Start: Backend server
[start]
cmd = "cd server && npm start"
